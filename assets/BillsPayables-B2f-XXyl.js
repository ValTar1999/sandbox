import{j as e,B as d,c as t,f as ie,a as p,r as c,u as te,I as w,M as A,R as ce,b as re,L as oe}from"./index-DKFBakVM.js";import{R as de,C as Q,S as xe,L as W,M as X,P as me,p as se,B as he}from"./PaymentStepProgress-bzjeVeu9.js";import{I as ae}from"./Input-BU7awu2j.js";const ue=({currentPage:l,totalPages:a,onPageChange:r,totalItems:m,onItemsPerPageChange:y,itemsPerPage:h})=>{const f=()=>{l>1&&r(l-1)},N=()=>{l<a&&r(l+1)},g=()=>{r(1)},u=()=>{r(a)},v=P=>{y(Number(P.target.value))},z=(l-1)*h+1,k=Math.min(l*h,m);return e.jsxs("div",{className:"flex items-center text-sm leading-5 text-gray-700",children:[e.jsxs("div",{className:"mr-4 flex items-center",children:["Rows per page:",e.jsx("select",{value:h,onChange:v,className:"ml-2 p-2",children:[10,25,50].map(P=>e.jsx("option",{value:P,children:P},P))})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"mr-2",children:["Showing ",e.jsxs("b",{className:"font-semibold",children:[z," - ",k]})," of ",e.jsx("b",{className:"font-semibold",children:m})," results"]}),e.jsxs("div",{className:"grid grid-flow-col gap-2",children:[e.jsx(d,{variant:"secondary",size:"md",icon:"chevron-double-left",onClick:g,disabled:l===1,"aria-label":"Go to first page"}),e.jsx(d,{variant:"secondary",size:"md",icon:"chevron-left",onClick:f,disabled:l===1,"aria-label":"Go to previous page"}),e.jsx(d,{variant:"secondary",size:"md",icon:"chevron-right",onClick:N,disabled:l===a,"aria-label":"Go to next page"}),e.jsx(d,{variant:"secondary",size:"md",icon:"chevron-double-right",onClick:u,disabled:l===a,"aria-label":"Go to last page"})]})]})]})},je=({title:l="Payments Overview",description:a="0 Payments",selectedCount:r=0,onSearch:m,onDeselect:y,onPay:h,children:f,className:N})=>{const g=v=>{m==null||m(v.target.value)},u=r>0;return e.jsxs("div",{className:t("flex w-full items-center flex-wrap",N),children:[e.jsxs("div",{className:"grid gap-1 pr-12",children:[e.jsx("h3",{className:"text-lg font-medium",children:l}),a&&e.jsx("div",{className:"text-xs text-gray-500",children:a})]}),u&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-sm leading-5 text-gray-700",children:[r," Payments"]}),e.jsx("span",{className:"w-1px h-[21px] bg-gray-300 px-[0.5px]"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(d,{variant:"linkPrimary",size:"xs",onClick:y,children:"Deselect"}),e.jsx(d,{variant:"primary",size:"xs",onClick:h,children:"Pay"})]})]}),!u&&e.jsx(de,{}),e.jsxs("div",{className:"ml-auto grid grid-flow-col gap-6 pl-8",children:[e.jsx(ae,{placeholder:"Search",type:"text",className:"w-80",icon:"search",onChange:g}),e.jsx(d,{size:"lg",variant:"secondary",icon:"chevron-down",children:"Filter"})]}),f]})},fe={blue:"text-blue-600 bg-blue-50",red:"text-red-600 bg-red-50"},pe="inline-flex items-center px-3 py-2 rounded-md cursor-pointer",ge=({title:l,variant:a="blue",className:r,disabled:m,count:y,active:h,children:f,...N})=>{const g=t(pe,r,m?"text-gray-400":h?fe[a]:"text-gray-500",ie());return e.jsxs("button",{className:g,disabled:m,type:"button",...N,children:[e.jsx("div",{className:"text-sm font-medium",children:l||f}),!m&&y&&e.jsx(p,{size:"sm",color:!h&&a!=="red"?"gray":a,className:"ml-2",rounded:!0,children:y})]})},o={th:["p-4"],thText:["flex items-center text-start text-gray-500 text-xs uppercase tracking-wider font-medium"],td:["p-4"]},x={start:"start",center:"center",end:"end"},ye=({payments:l,selectedIds:a=[],onSelectionChange:r,onCancelClick:m,onReRunClick:y,onCancelBulkPaymentClick:h})=>{const[f,N]=c.useState([]),[g,u]=c.useState([]),[v,z]=c.useState(""),[k,P]=c.useState(null),B=c.useRef(null),F=te(),C=c.useMemo(()=>new Set(a),[a]),T=c.useMemo(()=>Array.from(new Set(l.map(s=>s.payee).filter(Boolean))),[l]),j=c.useMemo(()=>f.length===0?l:l.filter(s=>f.includes(s.payee)),[l,f]),b=c.useMemo(()=>j.map(s=>s.id),[j]),M=b.length>0&&b.every(s=>C.has(s)),I=b.some(s=>C.has(s));c.useEffect(()=>{const s=B.current;s&&(s.indeterminate=I&&!M)},[I,M]);const L=s=>{P(i=>i===s?null:s)},R=()=>{if(r)if(M)r(a.filter(s=>!b.includes(s)));else{const s=b.filter(i=>!C.has(i));r([...a,...s])}},G=(s,i)=>{r&&r(i?[...a,s]:a.filter(D=>D!==s))},Y=c.useMemo(()=>l.some(s=>s.paymentType),[l]),O=c.useMemo(()=>v?T.filter(s=>s.toLowerCase().includes(v.toLowerCase())):T,[T,v]),U=()=>{u(f),z("")},V=()=>{N(g)},_=()=>{u([])},H=s=>{u(i=>i.includes(s)?i.filter(D=>D!==s):[...i,s])},q=(s,i)=>{i.stopPropagation(),m(s)},J=()=>{const{setOpen:s}=re(),i=()=>s(!1),D=()=>{V(),s(!1)};return e.jsxs("div",{className:"w-[352px] rounded-lg border border-gray-200 bg-white shadow-sm divide-y divide-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between pl-6 pr-4 py-3",children:[e.jsx("div",{className:"text-lg leading-6 font-medium text-gray-900",children:"Filter by Payee"}),e.jsx(d,{variant:"linkSecondary",size:"lg",onClick:i,icon:"x"})]}),e.jsxs("div",{className:"px-6 py-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Payee Name"}),e.jsx(ae,{placeholder:"Search payee",value:v,onChange:S=>z(S.target.value)})]}),e.jsxs("div",{className:"mt-3 max-h-56 space-y-1 overflow-y-auto pr-1",children:[O.map(S=>e.jsxs("label",{className:"flex cursor-pointer items-center gap-2 py-1 text-sm text-gray-900",children:[e.jsx(Q,{checked:g.includes(S),onChange:()=>H(S)}),e.jsx("span",{className:"truncate",children:S})]},S)),O.length===0&&e.jsx("div",{className:"py-2 text-xs text-gray-400",children:"No payees found"})]})]}),e.jsxs("div",{className:"px-6 py-5 flex items-center justify-between gap-4",children:[e.jsx(d,{className:"w-full",variant:"secondary",size:"lg",onClick:_,children:"Reset all"}),e.jsx(d,{className:"w-full",variant:"primary",size:"lg",onClick:D,children:"Apply"})]})]})};return e.jsx("div",{className:"overflow-x-auto w-full px-6 grid",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dashed border-gray-200",children:[e.jsx("th",{className:"w-[52px] max-w-[52px] min-w-[52px]"}),e.jsx("th",{className:t("w-8 max-w-8 min-w-8",`${o.td}`),children:e.jsx("div",{className:t("flex",`justify-${x.center}`),children:e.jsx(Q,{ref:B,checked:j.length>0?M:!1,onChange:()=>R()})})}),e.jsx("th",{className:t(o.th),children:e.jsx("div",{className:t("flex",`justify-${x.end}`),children:e.jsx("button",{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:t(o.thText),children:"amount"}),e.jsx(w,{icon:"selector",className:"text-gray-400"})]})})})}),e.jsx("th",{className:t(o.th),children:e.jsx("div",{className:t("flex",`justify-${x.start}`),children:e.jsx("button",{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:t(o.thText),children:"bill reference"}),e.jsx(w,{icon:"selector",className:"text-gray-400"})]})})})}),e.jsx("th",{className:t(o.th),children:e.jsxs("div",{className:t("flex items-center gap-1",`justify-${x.start}`),children:[e.jsxs("button",{className:"flex items-center gap-1",children:[e.jsx("div",{className:t(o.thText),children:"payee"}),e.jsx(w,{icon:"selector",className:"text-gray-400"})]}),e.jsxs(A.Root,{placement:"bottom-end",children:[e.jsx(A.Trigger,{as:"span",onClick:U,children:e.jsx(d,{icon:"filter",size:"xs",variant:"linkSecondary"})}),e.jsx(A.Portal,{children:e.jsx(A.Positioner,{children:e.jsxs(A.Popup,{className:"z-50",children:[e.jsx(A.Arrow,{className:"fill-white text-gray-200"}),e.jsx(J,{})]})})})]})]})}),Y&&e.jsx("th",{className:t(o.th),children:e.jsxs("div",{className:t("flex items-center gap-1",`justify-${x.start}`),children:[e.jsx("div",{className:t(o.thText),children:"Payment Type"}),e.jsx(d,{icon:"filter",size:"xs",variant:"linkSecondary"})]})}),e.jsx("th",{className:t(o.th),children:e.jsxs("div",{className:t("flex items-center gap-1",`justify-${x.start}`),children:[e.jsx("div",{className:t(o.thText),children:"source"}),e.jsx(d,{icon:"filter",size:"xs",variant:"linkSecondary"})]})}),e.jsx("th",{className:t(o.th),children:e.jsxs("div",{className:t("flex items-center gap-1",`justify-${x.start}`),children:[e.jsx("div",{className:t("text-nowrap",`${o.thText}`),children:"Due Date"}),e.jsx(w,{icon:"selector",className:"text-gray-400"})]})}),e.jsx("th",{className:t(o.th),children:e.jsx("div",{className:t("flex items-center gap-1",`justify-${x.start}`),children:e.jsx("div",{className:t(o.thText),children:"status"})})})]})}),e.jsx("tbody",{children:j.map(s=>e.jsxs(ce.Fragment,{children:[e.jsxs("tr",{onClick:()=>L(s.id),className:t("hover:bg-gray-50 cursor-pointer transition-all duration-500",k===s.id&&"bg-gray-100",C.has(s.id)&&"bg-blue-50"),children:[e.jsx("td",{className:"w-[52px] max-w-[52px] min-w-[52px]",children:e.jsx(w,{icon:"chevron-right",className:t("ml-4",C.has(s.id)?"text-blue-500":"text-gray-500",k===s.id&&"rotate-90")})}),e.jsx("td",{className:t("w-8 max-w-8 min-w-8",`${o.td}`),children:e.jsx("div",{className:t("flex",`justify-${x.center}`),children:e.jsx(Q,{checked:C.has(s.id),onClick:i=>i.stopPropagation(),onChange:i=>G(s.id,i.target.checked)})})}),e.jsx("td",{className:t("w-[186px] max-w-[186px] min-w-[186px]",`${o.td}`),children:e.jsxs("div",{className:t("flex items-center gap-1",`justify-${x.end}`),children:[s.lock?e.jsx(w,{className:"text-gray-500",icon:"lock-closed"}):null,e.jsx("div",{className:"font-medium text-gray-900 text-sm",children:s.totalAmount}),e.jsx("div",{className:"text-gray-500",children:s.amountValute})]})}),e.jsx("td",{className:t("w-[140px] max-w-[140px] min-w-[140px]",`${o.td}`),children:e.jsx("div",{className:t("text-sm text-gray-500 flex",`justify-${x.start}`),children:s.billReference})}),e.jsx("td",{className:t("min-w-0 max-w-xs overflow-hidden",`${o.td}`),children:e.jsxs("div",{className:t("flex items-center gap-2",`justify-${x.start}`),children:[s.vendors&&s.vendors.length>0&&e.jsx(p,{size:"lg",rounded:!0,color:"gray",children:s.vendors.length}),e.jsx("div",{className:"text-sm text-gray-900 font-medium truncate",children:s.payee})]})}),s.paymentType&&e.jsx("td",{className:t(o.td),children:e.jsx("div",{className:t("flex items-center gap-2",`justify-${x.start}`),children:s.paymentType==="sd"?e.jsxs(e.Fragment,{children:[e.jsx("img",{className:"w-4.5 h-4.5",src:xe,alt:"icon-sd",loading:"lazy",decoding:"async"}),e.jsx("div",{className:"text-sm text-gray-900",children:"SMART Disburse"})]}):e.jsx("div",{className:"text-sm text-gray-900",children:s.paymentType})})}),e.jsx("td",{className:t(o.td),children:e.jsx("div",{className:t("text-sm text-gray-900 flex font-medium",`justify-${x.start}`),children:s.source})}),e.jsx("td",{className:t(o.td),children:e.jsx("div",{className:t("text-sm  flex",`justify-${x.start}`),children:s.status==="pastDue"?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"text-yellow-600 text-nowrap",children:s.dueDate}),e.jsx(w,{className:"text-yellow-500",icon:"exclamation-circle"})]}):e.jsx("div",{className:"text-gray-500 text-nowrap",children:s.dueDate})})}),e.jsx("td",{className:t(o.td),children:e.jsxs("div",{className:t("flex",`justify-${x.start}`),children:[s.status==="unprocessed"&&e.jsx(p,{icon:"flag",iconDirection:"left",children:"Unprocessed"}),s.status==="processed"&&e.jsx(p,{color:"blue",icon:"in-progress",iconDirection:"left",children:"Processing"}),s.status==="paid"&&e.jsx(p,{color:"green",icon:"check-circle",iconDirection:"left",children:"Paid"}),s.status==="failed"&&e.jsx(p,{color:"red",icon:"check-circle",iconDirection:"left",children:"Failed"}),s.status==="pastDue"&&e.jsx(p,{color:"red",icon:"calendar",iconDirection:"left",children:"Past Due"})]})}),s.status==="unprocessed"&&e.jsx("td",{className:"px-4",children:e.jsx("div",{className:t("flex",`justify-${x.end}`),children:e.jsx(d,{size:"md",onClick:i=>{i.stopPropagation(),F(`/payables/${s.id}`)},children:"Pay"})})}),s.status==="processed"&&e.jsx("td",{className:"px-4",children:e.jsx("div",{className:t("flex",`justify-${x.end}`),children:e.jsx(d,{variant:"gray",size:"md",onClick:i=>q(s,i),children:"Cancel"})})}),s.status==="failed"&&e.jsx("td",{className:"px-4",children:e.jsx("div",{className:t("flex",`justify-${x.end}`),children:e.jsx(d,{icon:"x",iconDirection:"right",variant:"gray",size:"md",onClick:i=>{i.stopPropagation(),y(s)},children:"Re-Run"})})}),s.status==="pastDue"&&e.jsx("td",{className:t(o)})]}),e.jsx("tr",{className:"border-b border-gray-200",children:e.jsx("td",{colSpan:8,className:"transition-all duration-500",children:e.jsxs("div",{className:`overflow-hidden transition-all duration-500 divide-y divide-gray-200 ${k===s.id?"max-h-[500px]":"max-h-0 overflow-hidden"}`,children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"p-4 w-40 flex-shrink-0 text-xs font-semibold uppercase text-gray-500",children:"Notes"}),e.jsx("div",{className:"px-4 py-3.5 text-sm font-medium text-gray-900",children:s.notes})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"p-4 w-40 flex-shrink-0 text-xs font-semibold uppercase text-gray-500",children:"Status"}),e.jsxs("div",{className:"px-4 py-3.5",children:[s.status==="unprocessed"&&e.jsx(p,{icon:"flag",iconDirection:"left",children:"Unprocessed"}),s.status==="processed"&&e.jsx(p,{color:"blue",icon:"in-progress",iconDirection:"left",children:"Processing"}),s.status==="paid"&&e.jsx(p,{color:"green",icon:"check-circle",iconDirection:"left",children:"Paid"}),s.status==="failed"&&e.jsx(p,{color:"red",icon:"check-circle",iconDirection:"left",children:"Failed"}),s.status==="pastDue"&&e.jsx(p,{color:"red",icon:"calendar",iconDirection:"left",children:"Past Due"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"p-4 w-40 flex-shrink-0 text-xs font-semibold uppercase text-gray-500",children:"Attachments"}),e.jsx("div",{className:"px-4 py-3.5",children:e.jsx(p,{children:s.attachments})})]})]}),s.status==="processed"&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-4 w-40 flex-shrink-0 text-xs font-semibold uppercase text-gray-500",children:"Actions"}),e.jsx("div",{className:"px-4 py-3.5",children:e.jsx(d,{variant:"gray",size:"md",onClick:i=>{i.stopPropagation(),h?h(s):m(s)},children:"Cancel Payment"})})]})]})})})]},s.id))})]})})},Ne=({open:l,onClose:a,onConfirm:r})=>l?e.jsx(W,{children:e.jsx(X,{className:"w-128",titleCenter:!0,title:"Cancel Payment",description:"Are you sure you want to cancel payment?",icon:e.jsx(w,{icon:"exclamation",className:"-mb-2 -mt-4 h-11 w-11 text-red-500"}),onClose:a,footer:e.jsxs("div",{className:"grid grid-cols-2 items-center gap-6",children:[e.jsx(d,{variant:"secondary",size:"xl",className:"w-full",onClick:a,children:"Go Back"}),e.jsx(d,{variant:"primaryDistructive",size:"xl",className:"w-full",onClick:r,children:"Cancel Payment"})]})})}):null,ve=({open:l,onClose:a,onConfirm:r})=>l?e.jsx(W,{children:e.jsx(X,{className:"w-128",titleCenter:!0,title:"Cancel Bulk Payment",description:'This payable is being processed as part of a <strong class="text-gray-900">bulk payment</strong>. Are you sure you want to cancel the entire bulk payment?',icon:e.jsx(w,{icon:"exclamation",className:"-mb-2 -mt-4 h-11 w-11 text-red-500"}),onClose:a,children:e.jsxs("div",{className:"flex flex-col gap-3 w-full -mt-2",children:[e.jsx(d,{variant:"primaryDistructive",size:"xl",className:"w-full",onClick:r,children:"Cancel Bulk Payment"}),e.jsx(d,{variant:"secondary",size:"xl",className:"w-full",onClick:a,children:"Go back"})]})})}):null,Ce=({open:l,onClose:a,onConfirm:r})=>l?e.jsx(W,{children:e.jsxs(X,{className:"w-150",title:"Payment Re-submitted!",description:"Your payment is in progress. Check back later for status updates. If there are additional actions for you to take, you'll be notified.",icon:e.jsx(w,{icon:"check-circle",className:"h-11 w-11 text-green-500"}),onClose:a,children:[e.jsx(me,{}),e.jsx(d,{size:"xl",className:"w-full",onClick:r,children:"Done"})]})}):null,E={"Ready to Pay":"unprocessed","In Progress":["processed","pastDue"],Paid:"paid",Exceptions:"failed"},Pe=()=>{const l=te(),[a,r]=c.useState("Ready to Pay"),[m,y]=c.useState(null),[h,f]=c.useState(!1),[N,g]=c.useState(1),[u,v]=c.useState(10),[z,k]=c.useState(!1),[P,B]=c.useState(!1),[F,C]=c.useState(!1),[T,j]=c.useState(null),[b,M]=c.useState([]);c.useEffect(()=>{if(!h||!m)return;const n=setTimeout(()=>{r(m),g(1),y(null),f(!1)},1e3);return()=>clearTimeout(n)},[h,m]);const I=c.useMemo(()=>{const n=Object.keys(E),$={};return n.forEach(Z=>{const K=E[Z];$[Z]=se.reduce((le,ee)=>{const ne=Array.isArray(K)?K.includes(ee.status):ee.status===K;return le+(ne?1:0)},0)}),$},[]),L=n=>{n!==a&&(f(!0),y(n))},R=c.useMemo(()=>{const n=E[a];return se.filter($=>Array.isArray(n)?n.includes($.status):$.status===n)},[a]),G=c.useMemo(()=>{const n=N*u,$=n-u;return R.slice($,n)},[N,u,R]),Y=c.useMemo(()=>Math.ceil(R.length/u),[R.length,u]),O=n=>g(n),U=n=>{v(n),g(1)},V=n=>{j(n),k(!0)},_=n=>{j(n),C(!0)},H=()=>{console.log("Cancelling payment:",T),k(!1),j(null)},q=()=>{console.log("Re-running payment:",T),C(!1),j(null)},J=()=>{k(!1),j(null)},s=n=>{j(n),B(!0)},i=()=>{console.log("Cancelling bulk payment:",T),B(!1),j(null)},D=()=>{B(!1),j(null)},S=()=>{C(!1),j(null)};return e.jsxs(he,{className:"max-w-9xl mx-auto",header:e.jsx(je,{description:`${R.length} Payments`,selectedCount:b.length,onDeselect:()=>M([]),onPay:()=>{b.length>0&&l("/payables/multiple",{state:{selectedIds:b}})}}),footer:e.jsx("div",{className:"w-full flex justify-end",children:e.jsx(ue,{currentPage:N,totalPages:Y,onPageChange:O,totalItems:R.length,onItemsPerPageChange:U,itemsPerPage:u})}),children:[e.jsx("div",{className:"px-6 py-4",children:e.jsx("div",{className:"flex gap-9",children:Object.keys(E).map(n=>e.jsx(ge,{active:a===n,onClick:()=>L(n),count:`${I[n]||0}`,variant:n==="Exceptions"?"red":void 0,children:n},n))})}),e.jsxs("div",{className:"relative min-h-fit",children:[e.jsx("div",{className:t("transition-opacity duration-500 ease-in-out",h?"opacity-0 pointer-events-none":"opacity-100"),children:e.jsx(ye,{payments:G,selectedIds:b,onSelectionChange:M,onCancelClick:V,onReRunClick:_,onCancelBulkPaymentClick:s})}),h&&e.jsx("div",{className:"flex justify-center items-center py-8 absolute inset-0",children:e.jsx(oe,{})})]}),e.jsx(Ne,{open:z,onClose:J,onConfirm:H}),e.jsx(ve,{open:P,onClose:D,onConfirm:i}),e.jsx(Ce,{open:F,onClose:S,onConfirm:q})]})};export{Pe as default};
