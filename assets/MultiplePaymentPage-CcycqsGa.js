import{r as a,c as oe,j as e,I as U,B as E,a as pe,u as ve,e as je}from"./index-CGyYjifa.js";import{L as xe,W as fe,S as ke,p as Se,B as Ne,R as we}from"./PaymentStepProgress-DlRBNYjX.js";import{I as ye,W as re,C as De,D as de,V as Ce,P as Me}from"./PaymentSubmittedModal-xp9qxLyD.js";import{I as Pe}from"./Input-DsFgBQSV.js";const Ae=[{id:"email-1",type:"email",value:"gary@company.eu"},{id:"email-2",type:"email",value:"gary.kovalchek@mail.eu"},{id:"phone-1",type:"phone",value:"+1 357-22-13546",label:"Main Office"},{id:"phone-2",type:"phone",value:"+1 357-22-01546",label:"Finances Department"}],le="Payment method is not available for this bank account. Please select another bank account or contact support for more information.",ue=[{label:"ACH",value:"ach",description:"1–3 business days",badge:"Recommended"},{label:"Wire",value:"wire",description:"Same business day"},{label:"SMART Disburse",value:"smart-disburse",iconImageSrc:ke,iconImageAlt:"SMART Disburse"},{label:"RTP",value:"rtp",inactive:!0,inactiveDescription:le},{label:"Check",value:"check",inactive:!0,inactiveDescription:le},{label:"SMART Exchange",value:"smart",inactive:!0,inactiveDescription:le}],me=[{label:"Secondary Bank Account",value:"secondary",description:"Bank AG ••••1010",descriptionPosition:"below",rightValue:"$111,921.02"},{label:"Main Bank Account",value:"main",description:"Bank AG ••••1010",descriptionPosition:"below",rightValue:"$111,921.02"},{label:"Insurance Bank Account",value:"insurance",description:"Bank AG ••••1911",descriptionPosition:"below",rightValue:"$56,921.02",inactive:!0}],Be=({open:g,onClose:S,onConfirm:b,payables:W=[],initialEmail:N="",initialContacts:v,initialPaymentMethod:M="",initialBankAccount:j="",isBulkPayment:F=!1})=>{const[m,d]=a.useState(""),[k,f]=a.useState(""),[P,i]=a.useState("gary@company.eu"),[o,h]=a.useState([]),[p,L]=a.useState(""),[A,x]=a.useState(!1),[$,R]=a.useState(!1),[X,Z]=a.useState(!1),B=a.useRef(null);a.useEffect(()=>{if(g){if(d(M),f(j),i(N||"gary@company.eu"),M==="smart-disburse")if(v&&v.length>0)h(v);else if(N){const t={id:`email-default-${Date.now()}`,type:"email",value:N};h([t])}else h([{id:"email-default-gary",type:"email",value:"gary@company.eu"}]);else h([]);L(""),x(!1),R(!1),Z(!1)}},[g,N,v,M,j]),a.useEffect(()=>{h(m==="smart-disburse"?t=>t.length===0?[{id:"email-default-gary",type:"email",value:"gary@company.eu"}]:t:t=>t.length>0?[]:t)},[m]),a.useEffect(()=>{const t=r=>{B.current&&!B.current.contains(r.target)&&(x(!1),R(!1))};if(g)return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[g]);const O=m==="ach"||m==="wire",y=m==="smart-disburse",G=a.useMemo(()=>({hasEmail:o.some(t=>t.type==="email"),hasPhone:o.some(t=>t.type==="phone"),selectedIds:new Set(o.map(t=>t.id))}),[o]),T=a.useMemo(()=>{if(!A)return[];const t=p.trim().toLowerCase(),{selectedIds:r,hasEmail:u,hasPhone:V}=G;return Ae.filter(l=>{var n,c;return r.has(l.id)||l.type==="email"&&u||l.type==="phone"&&V?!1:t?l.value.toLowerCase().includes(t)||((n=l.label)==null?void 0:n.toLowerCase().includes(t))||((c=l.subLabel)==null?void 0:c.toLowerCase().includes(t)):!0})},[p,G,A]),q=a.useCallback(t=>{h(r=>{const u=r.some(s=>s.type==="email"),V=r.some(s=>s.type==="phone");return t.type==="email"&&u||t.type==="phone"&&V?r:[...r,t]}),L(""),x(!1)},[]),w=a.useCallback(t=>{h(r=>r.filter(u=>u.id!==t))},[]),ie=a.useCallback(t=>{const r=t.target.value;o.length<2&&(L(r),x(!0))},[o.length]),I=a.useCallback(()=>{R(!0),o.length<2&&x(!0)},[o.length]);a.useEffect(()=>{p.trim()&&o.length<2&&x(!0)},[p,o.length]);const ee=a.useCallback(()=>{R(!1),setTimeout(()=>{var t;(t=B.current)!=null&&t.contains(document.activeElement)||x(!1)},200)},[]),z=a.useCallback(t=>{t.stopPropagation(),o.length<2&&x(!0)},[o.length]),te=a.useCallback(t=>{const r=o.length===2,u=p==="",V=o.length>0,s=t.key==="Delete"||t.key==="Backspace",l=t.key.length===1&&!t.ctrlKey&&!t.metaKey;if(s&&u&&V){t.preventDefault();const n=o[o.length-1];w(n.id),L(""),o.length>1&&x(!0)}r&&l&&t.preventDefault()},[p,o,w]),se=a.useCallback(()=>{var t;o.length<2&&(x(!0),(t=document.getElementById("smart-disburse-input-modal"))==null||t.focus())},[o.length]),D=a.useCallback(()=>{var t;(t=document.getElementById("smart-disburse-input-modal"))==null||t.focus(),o.length<2&&x(!0)},[o.length]),C=a.useMemo(()=>o.length===0&&!$?"Email address or phone number":"",[o.length,$]),H=a.useMemo(()=>oe("mt-1 flex flex-wrap items-center gap-2 rounded-md border bg-white px-3 py-2 shadow-sm text-base placeholder-gray-400 min-h-[42px]","cursor-text",$||A?"border-blue-600 ring-1 ring-blue-600":"border-gray-300"),[$,A]);if(!g)return null;const ne=new Set(W.map(t=>t.bankAccounts).filter(t=>!!t)).size>1,Q=F&&ne,Y=m!==""&&(!O||k!=="")&&(!y||o.length>0)&&(y||P.trim()!==""),_=()=>{const t=ue.find(u=>u.value===m),r=me.find(u=>u.value===k);b==null||b({paymentMethod:m,paymentMethodLabel:(t==null?void 0:t.label)??m,bankAccount:O?k:void 0,bankAccountLabel:O?(r==null?void 0:r.description)??(r==null?void 0:r.label):void 0,email:y?void 0:P.trim(),contacts:y?o:void 0,makeDefault:y?X:void 0}),S()};return e.jsx(xe,{children:e.jsx(fe,{className:"w-128 flex flex-col",header:e.jsx("div",{children:"Select Payment Method"}),onClose:S,footer:e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsx(E,{variant:"secondary",size:"lg",onClick:S,children:"Cancel"}),e.jsx(E,{size:"lg",onClick:_,disabled:!Y,children:"Save"})]}),children:e.jsxs("div",{className:"p-6 space-y-6",children:[Q&&e.jsx(ye,{color:"yellow",icon:"exclamation",title:"Multiple receiving bank accounts detected",text:"To proceed with the bulk payment, please make sure to choose a single receiving bank account."}),!y&&e.jsxs("div",{className:"space-y-4 bg-gray-50 p-4 rounded-md",children:[e.jsxs("div",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Who would you like to send the bill to?"}),e.jsx("div",{className:"text-gray-500",children:"Please enter the email address or phone number of the payee where the bill will be sent."})]}),e.jsx(Pe,{type:"text",value:P,onChange:t=>i(t.target.value),placeholder:"Enter email address or phone number"})]}),e.jsx(re,{label:"Method of Payment",placeholder:"Select payment method",options:ue,selectedValue:m,onSelect:d,showInactiveBadge:!0}),y&&e.jsx("div",{className:"rounded-md bg-gray-50 p-4 space-y-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:"Where would you like to send the payment link?"}),e.jsx("div",{className:"mt-2.5 text-sm text-gray-500",children:"Provide your payee's email address and/or phone number where the SMART Disburse payment token will be sent to."}),e.jsx("div",{className:"mt-4 text-sm font-medium text-gray-700 cursor-pointer",onClick:se,children:"Contact Addresses"}),e.jsxs("div",{className:"relative",ref:B,children:[e.jsxs("div",{className:H,onClick:D,children:[o.map(t=>e.jsxs("span",{tabIndex:0,role:"button",className:"inline-flex items-center gap-0.5 rounded-full border border-gray-200 bg-gray-100 px-1 py-0.5 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1",onClick:r=>r.stopPropagation(),onKeyDown:r=>{(r.key==="Delete"||r.key==="Backspace")&&(r.preventDefault(),r.stopPropagation(),w(t.id),setTimeout(()=>{var u;(u=document.getElementById("smart-disburse-input-modal"))==null||u.focus()},0))},children:[e.jsx(U,{icon:t.type==="email"?"mail":"phone",className:"h-3.5 w-3.5 text-gray-400"}),e.jsx("span",{className:"text-gray-900 text-sm leading-5",children:t.value})]},t.id)),o.length<2&&e.jsx("input",{id:"smart-disburse-input-modal",type:"text",value:p,onChange:ie,onFocus:I,onBlur:ee,onClick:z,onKeyDown:te,className:"min-w-[200px] flex-1 bg-transparent text-sm text-gray-900 outline-none cursor-text",placeholder:C})]}),A&&T.length>0&&e.jsx("div",{className:"absolute left-0 right-0 z-10 mt-1 py-1 rounded-md bg-white shadow-lg max-h-60 overflow-y-auto",children:T.map(t=>e.jsxs("button",{type:"button",className:"flex w-full cursor-pointer items-center gap-3 p-4 text-left text-base hover:bg-gray-100 transition-colors duration-300",onMouseDown:r=>{r.preventDefault()},onClick:r=>{r.preventDefault(),r.stopPropagation(),q(t)},children:[e.jsx(U,{icon:t.type==="email"?"mail":"phone",className:"h-5 w-5 text-gray-500"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-900",children:t.value}),t.label&&e.jsx("span",{className:"text-gray-500",children:t.label})]})]},t.id))})]})]})}),y&&e.jsx(De,{checked:!0,title:"Make default payment method",subtitle:"Checking this means next time you make a payment it will be pre-selected. You can change it anytime in <a href='#' class='text-blue-600 font-medium'>vendor profile</a>."}),O&&e.jsx(re,{label:"Select bank account",placeholder:"Select bank account",options:me,selectedValue:k,onSelect:f,showInactiveBadge:!0})]})})})},Ie=({open:g,onClose:S,onConfirm:b,totalAmountFormatted:W,amountValute:N,originationAccountLabel:v,originationAccountMasked:M,vendors:j,isBulkPayment:F=!1})=>{const[m,d]=a.useState(null),k=i=>{d(o=>o===i?null:i)},f=i=>{const o=i.includes(" • ")?" • ":i.includes(" · ")?" · ":null;return o?i.split(o)[0].trim():i},P=a.useMemo(()=>F||j.length>1,[F,j.length]);return g?e.jsx(xe,{children:e.jsx(fe,{className:"w-125",header:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(U,{icon:"lightning-bolt",variant:"outline",className:"w-6 h-6 text-blue-600"}),e.jsx("div",{className:"text-xl font-semibold text-gray-900",children:"Pay Now"})]}),onClose:S,footer:e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsx(E,{variant:"secondary",size:"lg",onClick:S,children:"Cancel"}),e.jsx(E,{size:"lg",onClick:b,children:"Pay Now"})]}),children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid gap-2 w-full",children:[e.jsxs("div",{className:"text-center text-2xl mb-4 flex items-center justify-center space-x-1",children:[e.jsx("div",{className:"font-bold text-gray-900",children:W}),e.jsx("div",{className:"text-gray-500",children:N})]}),e.jsxs("div",{className:"rounded-md border border-gray-200 bg-gray-50 p-4 grid grid-cols-2 gap-6 text-sm leading-5",children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Origination Account"}),e.jsxs("div",{className:"text-gray-700",children:[v," ",M]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-full bg-gray-50 ring-2 ring-inset ring-gray-200",children:e.jsx(U,{icon:"arrow-down",className:"text-gray-500"})})}),P&&e.jsx(ye,{color:"blue",icon:"information-circle",title:"You're about to make a Bulk Payment",text:"This means you'll consolidate multiple payments into one transaction, using a single receiving bank account for all payables."}),e.jsx("div",{className:"flex flex-col gap-2",children:j.map(i=>{const o=m===i.name,h=i.payables.length>0;return e.jsxs("div",{className:"rounded-md bg-gray-50 overflow-hidden",children:[e.jsxs("div",{className:oe("flex items-center gap-3 p-2",h&&"cursor-pointer hover:bg-gray-100/80"),onClick:()=>h&&k(i.name),children:[e.jsx(U,{icon:"chevron-right",className:oe("w-5 h-5 flex-shrink-0 text-gray-400 transition-transform duration-200 ease-out",o?"rotate-90":"")}),e.jsxs("div",{className:"flex items-center justify-between gap-2 w-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate max-w-[150px]",children:i.name})}),e.jsx(pe,{color:"gray",size:"sm",children:f(i.paymentMethod)})]}),e.jsxs("div",{className:"text-sm font-medium text-gray-900 whitespace-nowrap flex items-center gap-1",children:[i.amountFormatted," ",e.jsx("span",{className:"text-gray-500",children:"USD"})]})]})]}),e.jsx("div",{className:"grid transition-[grid-template-rows] duration-300 ease-in-out",style:{gridTemplateRows:o&&h?"1fr":"0fr"},children:e.jsx("div",{className:"min-h-0 overflow-hidden",children:h&&e.jsx("div",{className:"border-t border-gray-200 divide-y divide-gray-200 mx-2",children:i.payables.map(p=>e.jsxs("div",{className:"grid grid-cols-3 gap-4 font-medium text-sm py-2",children:[e.jsx("span",{className:"text-gray-500 uppercase ml-8",children:p.id}),e.jsxs("span",{className:"text-gray-500",children:["Due: ",e.jsx("span",{className:"text-gray-900",children:p.dueDate})]}),e.jsxs("span",{className:"text-gray-900 whitespace-nowrap text-right",children:["$",p.amount," ",e.jsx("span",{className:"text-gray-500",children:"USD"})]})]},p.id))})})})]},i.name)})})]})})})}):null},he=[{label:"Secondary Bank Account",value:"secondary",description:"Bank AG ••••1010",descriptionPosition:"below",rightValue:"$111,921.02"},{label:"Main Bank Account",value:"main",description:"Bank AG ••••1010",descriptionPosition:"below",rightValue:"$111,921.02"},{label:"Insurance Bank Account",value:"insurance",description:"Bank AG ••••1911",descriptionPosition:"below",rightValue:"$56,921.02",inactive:!0}],Fe=()=>{var Q,Y,_,t,r,u,V;const g=ve(),S=je(),[b,W]=a.useState(""),[N,v]=a.useState(null),[M,j]=a.useState(null),[F,m]=a.useState(!1),[d,k]=a.useState(null),[f,P]=a.useState({}),[i,o]=a.useState({}),[h,p]=a.useState({}),[L,A]=a.useState({}),[x,$]=a.useState({}),[R,X]=a.useState(!1),[Z,B]=a.useState(!1),[O,y]=a.useState(!1),[G,T]=a.useState(!1),q=a.useMemo(()=>{var s;return((s=S.state)==null?void 0:s.selectedIds)??[]},[S.state]),w=a.useMemo(()=>Se.filter(s=>q.includes(s.id)),[q]),I=a.useMemo(()=>w.reduce((s,l)=>{const n=parseFloat(l.totalAmount.replace(/[$,]/g,""));return s+(Number.isNaN(n)?0:n)},0),[w]).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),ee=a.useCallback(()=>g(-1),[g]),z=((Q=w[0])==null?void 0:Q.dueDate)??"",te=a.useCallback(s=>{P(l=>{const n={...l};return delete n[s],n}),o(l=>{const n={...l};return delete n[s],n}),p(l=>{const n={...l};return delete n[s],n}),A(l=>{const n={...l};return delete n[s],n}),$(l=>{const n={...l};return delete n[s],n})},[]),se=a.useCallback(s=>{const l=s.toLowerCase();return l.includes("ach")?"ach":l.includes("wire")?"wire":l.includes("smart disburse")?"smart-disburse":""},[]),D=a.useMemo(()=>{const s=new Map;w.forEach(n=>{if(n.vendors&&n.vendors.length>0)n.vendors.forEach(c=>{const J=s.get(c.name);J?J.payables.push(...c.payables):s.set(c.name,{name:c.name,paymentMethod:c.paymentMethod||"",paymentMail:c.paymentMail,paymentPhone:c.paymentPhone,payables:[...c.payables]})});else{const c=s.get(n.payee);c?c.payables.push({id:n.billReference,dueDate:n.dueDate,amount:n.totalAmount.replace(/[$,]/g,""),bankAccounts:n.bankAccounts}):s.set(n.payee,{name:n.payee,paymentMethod:"",payables:[{id:n.billReference,dueDate:n.dueDate,amount:n.totalAmount.replace(/[$,]/g,""),bankAccounts:n.bankAccounts}]})}});const l=Array.from(s.values());return{id:"multiple",totalAmount:`$${I}`,amountValute:"USD",billReference:"",payee:"",source:"",dueDate:z,status:"unprocessed",notes:"",attachments:"",vendors:l}},[w,I,z]),C=a.useMemo(()=>he.find(s=>s.value===b),[b]),H=a.useMemo(()=>{const s=D.vendors??[];return s.length===0?!0:s.every(l=>(f[l.name]??l.paymentMethod??"").trim()!=="")},[D.vendors,f]),ae=a.useCallback(()=>{if(!b){B(!0);return}H&&(B(!1),y(!0))},[b,H]),ne=a.useMemo(()=>(D.vendors??[]).map(l=>{const n=l.payables??[],J=n.reduce((K,be)=>{const ce=parseFloat(be.amount.replace(/,/g,""));return K+(Number.isNaN(ce)?0:ce)},0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),ge=f[l.name]??l.paymentMethod??"";return{name:l.name,paymentMethod:ge,amountFormatted:J,payables:n.map(K=>({id:K.id,dueDate:K.dueDate,amount:K.amount.replace(/,/g,"")}))}}),[D,f]);return e.jsxs(Ne,{className:"max-w-7xl mx-auto",header:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(E,{variant:"add_on",icon:"arrow-left",onClick:ee}),e.jsx("span",{className:"text-lg font-medium text-gray-900 ml-4",children:"Initiate a Payment"})]}),e.jsx(we,{})]}),footer:e.jsxs("div",{className:"flex items-center gap-2 w-full justify-end",children:[e.jsxs(E,{size:"md",onClick:ae,children:["Pay: $",I]}),e.jsx(de,{dueDate:z,onSelectDate:v,selectedIndex:M,setSelectedIndex:j,handleChooseDataClick:()=>{}})]}),children:[e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-2xl font-bold",children:[e.jsxs("span",{className:"text-gray-900",children:["$",I]})," ",e.jsx("span",{className:"text-gray-500",children:"USD"})]}),e.jsx(pe,{icon:"flag",iconDirection:"left",children:"Unprocessed"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(E,{size:"md",onClick:ae,children:["Pay: $",I]}),e.jsx(de,{dueDate:z,onSelectDate:v,selectedIndex:M,setSelectedIndex:j,handleChooseDataClick:()=>{}})]})]}),N&&e.jsx("div",{className:"flex justify-end mt-2",children:e.jsxs("div",{className:"text-sm font-semibold inline-flex",children:[e.jsxs("div",{className:"px-2 flex items-center gap-1 text-gray-600 bg-gray-50 border border-gray-300 rounded-l-md",children:[e.jsx(U,{className:"w-4.5 h-4.5",icon:"calendar",variant:"outline"}),e.jsx("div",{children:"Schedule for:"})]}),e.jsxs("div",{className:"flex items-center border-y border-r border-gray-200 rounded-r-md",children:[e.jsx("div",{className:"text-blue-600 pl-2",children:N}),e.jsx(E,{size:"sm",icon:"x",variant:"add_on",onClick:()=>{v(null),j(null)}})]})]})})]}),e.jsx("div",{className:"grid grid-cols-2 pb-1",children:e.jsx(re,{label:"Origination Account",labelIcon:"information-circle",placeholder:"Select account",options:he,selectedValue:b,onSelect:s=>{W(s),B(!1)},footerActionLabel:"Add New Bank Account",showInactiveBadge:!1,showInactiveNotice:!0,error:Z,errorMessage:"Please select an origination account."})}),e.jsx("div",{className:"pt-14",children:e.jsx(Ce,{payment:D,vendorPaymentMethods:f,vendorPaymentEmails:i,vendorPaymentContacts:h,vendorBankAccounts:L,vendorBulkPayment:x,onSelectPaymentMethodClick:(s,l)=>{k(s),X(l??!1),m(!0)},onBulkPaymentChange:(s,l)=>{$(n=>({...n,[s]:l}))},onDiscardPaymentMethod:te},`methods-${Object.keys(f).length}-${Object.entries(f).map(([s,l])=>`${s}:${l}`).sort().join(";")}`)})]}),e.jsx(Be,{open:F,onClose:()=>{m(!1),k(null)},onConfirm:s=>{const l=d;if(l){if(P(n=>({...n,[l]:s.paymentMethodLabel})),s.contacts&&s.contacts.length>0){p(c=>({...c,[l]:s.contacts}));const n=s.contacts[0];o(c=>({...c,[l]:n.value}))}else s.email&&o(n=>({...n,[l]:s.email}));s.bankAccount&&s.bankAccountLabel&&A(n=>({...n,[l]:{value:s.bankAccount,label:s.bankAccountLabel}}))}m(!1),k(null)},payables:d?(_=(Y=D.vendors)==null?void 0:Y.find(s=>s.name===d))==null?void 0:_.payables:void 0,initialEmail:d?i[d]??"":"",initialContacts:d?h[d]:void 0,initialPaymentMethod:d?se(f[d]??((r=(t=D.vendors)==null?void 0:t.find(s=>s.name===d))==null?void 0:r.paymentMethod)??""):"",initialBankAccount:d?((u=L[d])==null?void 0:u.value)??"":"",isBulkPayment:R}),e.jsx(Ie,{open:O,onClose:()=>y(!1),onConfirm:()=>{y(!1),T(!0)},totalAmountFormatted:`$${I}`,amountValute:"USD",originationAccountLabel:(C==null?void 0:C.label)??"",originationAccountMasked:C!=null&&C.description?"••••"+(((V=C.description.match(/\d{4}/))==null?void 0:V[0])??""):"",vendors:ne,isBulkPayment:Object.values(x).some(s=>s)}),e.jsx(Me,{open:G,onClose:()=>T(!1),handlePaymentSubmittedClick:()=>{T(!1),g(-1)}})]})};export{Fe as default};
